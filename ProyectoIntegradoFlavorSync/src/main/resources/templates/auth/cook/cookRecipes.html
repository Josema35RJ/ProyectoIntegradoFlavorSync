<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FlavorSync - Mis Recetas</title>
<!-- CSS de Bootstrap 5 -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
	rel="stylesheet">
<!-- Font Awesome para iconos -->
<link
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
	rel="stylesheet">
<!-- CSS personalizado -->
<link rel="stylesheet" href="/css/cookRecipes.css">
<style>
body {
	background-color: #f8f9fa; /* Fondo más suave */
}

h1, h3 {
	color: #343a40; /* Color de encabezados */
}

.alert {
	margin-bottom: 20px; /* Espacio entre alertas y contenido */
}

.table {
	background-color: #fff; /* Fondo blanco para la tabla */
	border-radius: 8px; /* Bordes redondeados */
	overflow: hidden; /* Esquinas redondeadas */
}

.table th, .table td {
	vertical-align: middle; /* Alinear verticalmente */
}

.table-hover tbody tr:hover {
	background-color: #e2e6ea; /* Color de fondo al pasar el mouse */
}

.footer {
	background-color: #343a40; /* Color de fondo del footer */
}

.star {
	color: lightgray; /* Color de las estrellas vacías */
	font-size: 24px; /* Tamaño de la estrella */
}

.star.filled {
	color: gold; /* Color de las estrellas llenas */
}
</style>
</head>
<body>
	<!-- Navbar -->
	<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
		<div class="container-fluid">
			<a class="navbar-brand" href="#"><i class="fas fa-utensils"></i>
				FlavorSync</a>
			<button class="navbar-toggler" type="button"
				data-bs-toggle="collapse" data-bs-target="#navbarNav"
				aria-controls="navbarNav" aria-expanded="false"
				aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarNav">
				<ul class="navbar-nav ms-auto mb-2 mb-lg-0">
					<li class="nav-item"><a href="/auth/cook/formRecipe"
						class="btn btn-success me-3"><i class="fas fa-plus"></i> Crear
							Receta</a></li>
					<li class="nav-item"><a class="nav-link"
						href="/auth/cook/cookPanel">Home</a></li>
					<li class="nav-item"><a class="nav-link"
						href="/auth/cook/cookPerfil"><i class="fas fa-user"></i> Mi
							Perfil</a></li>
					<li class="nav-item"><a class="nav-link"
						href="/auth/cook/logout"><i class="fas fa-sign-out-alt"></i>
							Cerrar Sesión</a></li>
				</ul>
			</div>
		</div>
	</nav>

	<!-- Contenido Principal -->
	<main class="container my-5">
		<!-- Mensaje de éxito -->
		<div th:if="${success}" class="alert alert-success" role="alert">
			<span th:text="${success}"></span>
		</div>

		<!-- Mensaje de error -->
		<div th:if="${error}" class="alert alert-danger" role="alert">
			<span th:text="${error}"></span>
		</div>

		<!-- Título y datos del cocinero -->
		<div class="row mb-4">
			<div class="col text-center">
				<h1>Mis Recetas</h1>
				<h3>
					Bienvenido, <span th:text="${cook}"></span>!
				</h3>
				<img th:src="${base64Image}"
					style="width: 150px; height: 150px; border-radius: 50%; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); object-fit: cover;"
					alt="Imagen de perfil">
			</div>
		</div>

		<!-- Tabla de Recetas -->
		<div class="row">
			<div class="col">
				<table class="table table-hover align-middle">
					<thead class="table-dark">
						<tr>
							<th scope="col">Imagen</th>
							<th scope="col">Nombre de la Receta</th>
							<th scope="col">Nivel</th>
							<th scope="col">Comensales</th>
							<th scope="col">Tiempo de Preparación (min)</th>
							<th scope="col">Categoría</th>
							<th scope="col">Calificación Promedio</th>
							<th scope="col">Comentarios</th>
							<th scope="col">Acciones</th>
						</tr>
					</thead>
					<tbody>
						<!-- Iterar sobre las recetas -->
						<tr th:each="recipe, stat : ${recipes}">
							<td><img th:src="${base64listImage.get(recipe.id)}"
								alt="Imagen de la receta"></td>
							<td th:text="${recipe.name}">Nombre de la Receta</td>
							<td th:text="${recipe.level}">Nivel</td>
							<td th:text="${recipe.diners}">Comensales</td>
							<td th:text="${recipe.preparationTime}">Tiempo de
								Preparación</td>
							<td th:text="${recipe.category}">Categoría</td>
							<td><span th:each="i : ${#numbers.sequence(1, 5)}"
								th:class="${i <= recipe.averageRating ? 'star filled' : 'star'}"
								aria-hidden="true">★</span></td>
							<td th:text="${recipe.listComments}">Comentarios</td>
							<td>
								<button type="button" class="btn btn-info"
									data-bs-toggle="modal" data-bs-target="#recipeModal"
									data-name="${recipe.name}" data-level="${recipe.level}"
									data-preparation-time="${recipe.preparationTime}"
									data-diners="${recipe.diners}"
									data-instructions="${recipe.instructions}"
									data-difficulty="${recipe.difficulty}"
									data-utensils="${recipe.listkitchenUtensils}"
									data-allergens="${recipe.AllergensAndDietaryRestrictions}"
									data-categories="${recipe.category}"
									data-grades="${recipe.grades}">Ver</button> <a
								th:href="@{'/auth/cook/updateRecipe/' + ${recipe.id}}"
								class="btn btn-warning btn-sm me-1"> <i class="fas fa-edit"></i>
									Editar
							</a> <a class="btn btn-warning btn-sm me-1"> <i
									class="fas fa-edit"></i> Ver Comentarios
							</a>
							</td>
						</tr>
						<!-- Mostrar un mensaje si no hay recetas -->
						<tr th:if="${recipes.size() == 0}">
							<td colspan="8" class="text-center">No hay recetas
								disponibles.</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</main>

	<!-- Modal structure -->
	<div class="modal fade" id="recipeModal" tabindex="-1" role="dialog"
		aria-labelledby="recipeModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content rounded-4 shadow">
				<div class="modal-header border-0">
					<h5 class="modal-title" id="recipeModalLabel">Detalles de la
						Receta</h5>
					<button type="button" class="close" data-bs-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">×</span>
					</button>
				</div>
				<div class="modal-body" id="recipeDetails">
					<!-- Aquí se llenarán los detalles de la receta con JavaScript -->
				</div>
				<div class="modal-footer border-0">
					<button type="button" class="btn btn-outline-secondary"
						data-bs-dismiss="modal">Cerrar</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Footer -->
	<footer class="footer mt-auto py-3 bg-dark text-light">
		<div class="container text-center">
			<span>© 2024 FlavorSync - Todos los derechos reservados</span>
		</div>
	</footer>

	<!-- Scripts de Bootstrap -->
	<!-- jQuery CDN -->
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script
		src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"></script>
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
	<script>
	// Variables globales para almacenar los datos de la receta
	let recipeName = '';
	let recipeLevel = '';
	let recipePreparationTime = '';
	let recipeDiners = '';
	let recipeInstructions = '';
	let recipeDifficulty = '';
	let recipeUtensils = '';
	let recipeAllergens = '';
	let recipeCategories = '';
	let recipeGrades = '';

	// Función para establecer los valores en las variables globales
	function setModalValues(button) {
	    // Extraer los valores de los atributos de datos del botón
	    recipeName = button.getAttribute('data-name');
	    recipeLevel = button.getAttribute('data-level');
	    recipePreparationTime = button.getAttribute('data-preparation-time');
	    recipeDiners = button.getAttribute('data-diners');
	    recipeInstructions = button.getAttribute('data-instructions');
	    recipeDifficulty = button.getAttribute('data-difficulty');
	    recipeUtensils = button.getAttribute('data-utensils');
	    recipeAllergens = button.getAttribute('data-allergens');
	    recipeCategories = button.getAttribute('data-categories');
	    recipeGrades = button.getAttribute('data-grades');
	}

	// Función para mostrar los valores en el modal
	function populateModal() {
	    // Establecer el contenido del modal usando las variables globales
	    const modalContent = `
	        <h6>${recipeName}</h6>
	        <p><strong>Nivel:</strong> ${recipeLevel}</p>
	        <p><strong>Tiempo de Preparación:</strong> ${recipePreparationTime} minutos</p>
	        <p><strong>Comensales:</strong> ${recipeDiners}</p>
	        <p><strong>Instrucciones:</strong> ${recipeInstructions}</p>
	        <p><strong>Dificultad:</strong> ${recipeDifficulty}</p>
	        <p><strong>Utensilios:</strong> ${recipeUtensils}</p>
	        <p><strong>Alérgenos:</strong> ${recipeAllergens}</p>
	        <p><strong>Categorías:</strong> ${recipeCategories}</p>
	        <p><strong>Calificaciones:</strong> ${recipeGrades}</p>
	    `;

	    // Actualizar el contenido del modal
	    document.getElementById('recipeDetails').innerHTML = modalContent;
	}

	// Vinculación con el evento del modal para mostrar los detalles de la receta
	document.getElementById('recipeModal').addEventListener('show.bs.modal', function (event) {
	    const button = event.relatedTarget; // Botón que activó el modal
	    setModalValues(button); // Llamar a la función para establecer los valores
	    populateModal(); // Llamar a la función para mostrar los valores en el modal
	});
	</script>
</body>
</html>
